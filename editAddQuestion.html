<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="">
  <meta name="author" content="">
  <title>this is title</title>
  <link rel="stylesheet" type="text/css" href="css/admin.css">
  <link rel="stylesheet" type="text/css" href="css/addquestion.css">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.3/jquery.validate.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery-validation@1.19.3/dist/additional-methods.min.js"></script>
  
  <script src="js/myfunctions.js"> </script>
  <script src="//cdn.ckeditor.com/4.5.11/full/ckeditor.js"></script>
  <!-- <script src="https://cdn.ckeditor.com/4.17.1/standard/ckeditor.js"></script> -->

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="stylesheet" href="RichText/src/richtext.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/js/all.min.js"></script>
  <script src="RichText/src/jquery.richtext.min.js"></script>

  
</head>

<body>
  <script>

  if(getit("signinUser")=="undefined" || getit("signinUser")==""){
    window.location.href="signadmin.html";  /////跳转到另一页面
  }
  else if(getit("number")=="undefined"){

    window.location.href="quiz.html";  /////跳转到另一页面
  }


  function askphp(queryString,columnSets,callback){
      $.ajax({    //create an ajax request to load_page.php
	  async: true,
	  global: false,
	  data: {queryString: queryString,columnSets: columnSets},
	  type: "POST",
	  url: "askphp.php",
	  dataType: "json",   //expect html to be returned
	  success: callback
      });   // ajax
  }


    $(function(){
	// https://github.com/webfashionist/RichText
	// https://stackoverflow.com/questions/19491336/how-to-get-url-parameter-using-jquery-or-plain-javascript
	let searchParams = new URLSearchParams(window.location.search);
	var englishMode=false;
	var sqlmode;
	if(searchParams.get('mode')=="edit"){
	    sqlmode="update";
	}else{
	    sqlmode="insert";
	}
	
	if(searchParams.get('mode')=="edit" && searchParams.get('isEnglish')=="true"){
	    englishMode=true;
	    $('#question').richText();
	    $('#detail').css("height","50px");
	}
	else
	    $('#detail').richText();
	if(searchParams.get('mode')=="edit"){
	    var number=getit("number");
	    var str = "SELECT category,question,answer,detail FROM tbquiz  WHERE number="+number;
	    var stringArr=["category","question","answer","detail"];
	    var oneset=[];
	    askphp(str,stringArr,function(result){
		console.log(result);
		$("#category").val(result[1]);
		$("#question").val(result[2]).trigger("change");
		$("#answer").val(result[3]);
		$("#detail").val(result[4]).trigger("change");  /// you need this to trigger the show (RichText from github)
	    });
	}


	$("#form1").submit(function(e){
	    $("#question").trigger("change");
	    $("#detail").trigger("change");
	    var category=$("#category").val();
	    var question=$("#question").val();
	    var answer=$("#answer").val();
	    var detail=$("#detail").val();
	    console.log("new question:"+question);
	    console.log("new detail:"+detail);
	    
	    var arr=[category,question,answer,detail];
	    $.ajax({    //create an ajax request to load_page.php
		async: false,
		global: false,
		data: { sqlmode: sqlmode, number: number,category: category, question: question, answer:answer, detail:detail},
		type: "POST",
		url: "updateAddQuestion.php",
		dataType: "json",   //expect html to be returned
		success: function(response){
		    console.log("response:"+response);
		}
	    });   // ajax
	    //    e.preventDefault();
    });


  });  //ready
  </script>


  <div class="container">

    <div id="bar">
      Hello, Administrator!
      <a href="signadmin.html">Back to Admin </a>
      <a href="quiz.html"> Back to Quiz</a>
    </div>

    <div>
      <form id="form1" method="post"  action="javascript:void(0);">
        Category: <input type="number" name="category" id="category" min="0" max="99" required> <br>
        Question: <br>
        <textarea name="question" id="question" rows="1"> </textarea> <br>
        Answer: <br>
        <textarea name="answer"  id="answer" >   </textarea> <br>
        Detail: <br>
        <textarea name="detail"  id="detail">   </textarea> <br>
        <input type="submit" value="Change It!">
	<!-- <script> -->
	<!--   CKEDITOR.replace( 'detail' ); -->
	<!-- </script> -->
      </form>
    </div>


  </div>
</body>
